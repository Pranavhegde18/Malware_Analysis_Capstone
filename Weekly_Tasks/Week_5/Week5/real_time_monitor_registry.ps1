# Define the registry path to monitor
$registryPath = "HKCU\Software\MyApp"

# Get the registry key to monitor
$registryKey = [Microsoft.Win32.Registry]::CurrentUser.OpenSubKey("Software\MyApp", $true)

if ($registryKey -eq $null) {
    Write-Host "Registry key not found. Make sure the path is correct."
    exit
}

# Create a hash table to store the initial values
$global:initialValues = @{}

# Store the initial values in the hash table
foreach ($valueName in $registryKey.GetValueNames()) {
    $global:initialValues[$valueName] = $registryKey.GetValue($valueName)
}

# Function to check for registry changes
function CheckRegistryChanges {
    $changedValues = @{}

    # Check for changes in the registry key
    foreach ($valueName in $registryKey.GetValueNames()) {
        $oldValue = $global:initialValues[$valueName]
        $newValue = $registryKey.GetValue($valueName)

        if ($oldValue -ne $newValue) {
            $changedValues[$valueName] = @{
                OldValue = $oldValue
                NewValue = $newValue
            }
        }
    }

    # Print the changed values
    if ($changedValues.Count -gt 0) {
        Write-Host "Registry changes detected:"
        foreach ($valueName in $changedValues.Keys) {
            $oldValue = $changedValues[$valueName].OldValue
            $newValue = $changedValues[$valueName].NewValue

            Write-Host "Name : $valueName"
            Write-Host "Old  : $oldValue"
            Write-Host "New  : $newValue"
            Write-Host
        }
    }
}

Write-Host "Monitoring registry changes. Press Ctrl+C to stop..."

# Continuously check for registry changes
while ($true) {
    CheckRegistryChanges
    Start-Sleep -Milliseconds 10000
}
