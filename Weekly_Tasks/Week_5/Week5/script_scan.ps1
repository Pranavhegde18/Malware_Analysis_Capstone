# Function to scan registry for potential IOCs
function ScanRegistry {
    param (
        [Parameter(Mandatory = $true)]
        [string]$RegistryPath
    )

    # Array of IOCs to check against
    $iocs = @(
        "IOC1"
        # Add more IOCs as needed
    )

    $keys = Get-ChildItem -Path $RegistryPath -Recurse -ErrorAction SilentlyContinue
    foreach ($key in $keys) {
        $keyValueNames = Get-ItemProperty -Path $key.PSPath | Select-Object -ExpandProperty PSChildName
        foreach ($ioc in $iocs) {
            if ($keyValueNames -contains $ioc) {
                Write-Host "Potential IOC found in registry key: $($key.PSPath)"
                # You can take additional actions here, such as logging or notifying
            }
        }
    }
}

# Function to scan running processes for potential IOCs
function ScanProcesses {
    # Array of IOCs to check against
    $iocs = @(
        "IOC4"
        # Add more IOCs as needed
    )

    $processes = Get-Process
    foreach ($process in $processes) {
        $processName = $process.ProcessName
        foreach ($ioc in $iocs) {
            if ($processName -eq $ioc) {
                Write-Host "Potential IOC found in running process: $($process.Name)"
                # You can take additional actions here, such as logging or terminating the process
            }
        }
    }
}

# Function to scan system files for potential IOCs
function ScanSystemFiles {
    param (
        [Parameter(Mandatory = $true)]
        [string]$FolderPath
    )

    # Array of IOCs to check against
    $iocs = @(
        "IOC7"
        # Add more IOCs as needed
    )

    $files = Get-ChildItem -Path $FolderPath -Recurse -File -ErrorAction SilentlyContinue
    foreach ($file in $files) {
        $content = Get-Content -Path $file.FullName -Raw -ErrorAction SilentlyContinue
        foreach ($ioc in $iocs) {
            if ($content -match $ioc) {
                Write-Host "Potential IOC found in system file: $($file.FullName)"
                # You can take additional actions here, such as logging or quarantining the file
            }
        }
    }
}

# Specify the paths to scan
$registryPath = "HKLM:\Software\Windows\CurrentVersion"
$systemFilesPath = "C:\Windows\System32"

# Perform the scans
Write-Host "Scanning registry..."
ScanRegistry -RegistryPath $registryPath

Write-Host "Scanning running processes..."
ScanProcesses

Write-Host "Scanning system files..."
ScanSystemFiles -FolderPath $systemFilesPath

# Stop a script by name
# Stop-Process -Name "script_scan.ps1"
