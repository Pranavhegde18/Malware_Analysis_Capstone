# Disable unnecessary services
$servicesToDisable = @(
    "Telnet",
    "FTP",
    "Server",
    "RemoteRegistry"
)

foreach ($service in $servicesToDisable) {
    Set-Service -Name $service -StartupType Disabled
    Stop-Service -Name $service -Force
}

# Configure Windows Firewall
Set-NetFirewallProfile -Profile Domain, Public, Private -Enabled True
Set-NetFirewallProfile -Profile Domain, Public, Private -DefaultInboundAction Deny
Set-NetFirewallProfile -Profile Domain, Public, Private -DefaultOutboundAction Allow

# Enable Windows Defender and update definitions
Set-MpPreference -DisableRealtimeMonitoring $false
Update-MpSignature

# Disable PowerShell script execution policy
Set-ExecutionPolicy -ExecutionPolicy Restricted -Force

# Enable Windows automatic updates
Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update" -Name AUOptions -Value 4

# Enable User Account Control (UAC)
Set-ItemProperty -Path "HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\System" -Name EnableLUA -Value 1

# Enable BitLocker (if available)
Enable-BitLocker -MountPoint "C:" -EncryptionMethod XtsAes256 -UsedSpaceOnly

# Restrict Remote Desktop access
Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server" -Name fDenyTSConnections -Value 1

# Configure strong password policy
$securityPolicy = Get-WmiObject -Class Win32_AccountPolicy -Namespace "root\rsop\computer"
$securityPolicy.SetPasswordComplexity(1)
$securityPolicy.SetMinimumPasswordLength(12)

# Disable guest account
Disable-LocalUser -Name "Guest"

# Enable Windows Event Log forwarding
$eventCollector = "EventCollectorServer.domain.com"
wevtutil sl Security /ca:O:"$(hostname)" /r:"$eventCollector"

# Enable PowerShell transcription logging
Enable-PSTranscript -Force -OutputDirectory "C:\Logs"

# Restart the system to apply changes
Restart-Computer -Force
