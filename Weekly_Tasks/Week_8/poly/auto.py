import os
import shutil
import winreg

def associate_file_extension(file_extension, file_type_description, executable_path):
    # Get the HKEY_CURRENT_USER\Software\Classes registry key
    classes_key = winreg.OpenKey(winreg.HKEY_CURRENT_USER, r"Software\Classes", 0, winreg.KEY_ALL_ACCESS)

    # Create a new subkey for the file extension
    file_ext_key = winreg.CreateKey(classes_key, file_extension)
    winreg.SetValue(file_ext_key, None, winreg.REG_SZ, file_type_description)

    # Create a new subkey for the file type
    file_type_key = winreg.CreateKey(classes_key, file_type_description)
    winreg.SetValue(file_type_key, None, winreg.REG_SZ, file_type_description)

    # Create a new subkey for the shell open command
    shell_key = winreg.CreateKey(file_type_key, "shell")
    open_key = winreg.CreateKey(shell_key, "open")
    command_key = winreg.CreateKey(open_key, "command")
    winreg.SetValue(command_key, None, winreg.REG_SZ, f'"{executable_path}" "%%1"')

    # Close the registry keys
    winreg.CloseKey(command_key)
    winreg.CloseKey(open_key)
    winreg.CloseKey(shell_key)
    winreg.CloseKey(file_type_key)
    winreg.CloseKey(file_ext_key)
    winreg.CloseKey(classes_key)

def automate_file_association(txt_file_path, batch_file_path):
    # Associate .txt file extension with the batch file
    associate_file_extension(".txt", "Text Document", batch_file_path)

    # Copy the batch file to the directory of the text file
    batch_file_name = os.path.basename(batch_file_path)
    txt_file_directory = os.path.dirname(txt_file_path)
    target_batch_file_path = os.path.join(txt_file_directory, batch_file_name)
    shutil.copyfile(batch_file_path, target_batch_file_path)

    # Execute the batch file with the text file as an argument
    os.system(f'"{target_batch_file_path}" "{txt_file_path}"')

# Usage example
txt_file_path = r'path\to\example.txt'
batch_file_path = r'path\to\encrypt_notepad.bat'

automate_file_association(txt_file_path, batch_file_path)
