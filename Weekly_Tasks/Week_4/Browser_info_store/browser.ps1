# Define the folder path where the information will be stored
$folderPath = "C:\BrowserInfo"

# Create the folder if it doesn't exist
if (-not (Test-Path -Path $folderPath)) {
    New-Item -ItemType Directory -Path $folderPath | Out-Null
}

# Import the necessary SQLite module
Import-Module -Name SQLite

# Get browser-related information

# Google Chrome
$chromeHistoryPath = "$env:LOCALAPPDATA\Google\Chrome\User Data\Default\History"
$chromeBookmarksPath = "$env:LOCALAPPDATA\Google\Chrome\User Data\Default\Bookmarks"

# Firefox
$firefoxHistoryPath = "$env:APPDATA\Mozilla\Firefox\Profiles\*.default\places.sqlite"
$firefoxBookmarksPath = "$env:APPDATA\Mozilla\Firefox\Profiles\*.default\bookmarkbackups"

# Brave
$braveHistoryPath = "$env:LOCALAPPDATA\BraveSoftware\Brave-Browser\User Data\Default\History"
$braveBookmarksPath = "$env:LOCALAPPDATA\BraveSoftware\Brave-Browser\User Data\Default\Bookmarks"
$braveCookiesPath = "$env:LOCALAPPDATA\BraveSoftware\Brave-Browser\User Data\Default\Cookies"

# Function to read SQLite database and export to CSV
function Export-SqliteToCsv {
    param(
        [Parameter(Mandatory = $true)]
        [ValidateNotNullOrEmpty()]
        [String]$DatabasePath,

        [Parameter(Mandatory = $true)]
        [ValidateNotNullOrEmpty()]
        [String]$Query,

        [Parameter(Mandatory = $true)]
        [ValidateNotNullOrEmpty()]
        [String]$OutputPath
    )

    try {
        $connectionString = "Data Source={0};Version=3" -f $DatabasePath
        $connection = New-Object -TypeName System.Data.SQLite.SQLiteConnection -ArgumentList $connectionString
        $connection.Open()

        $command = $connection.CreateCommand()
        $command.CommandText = $Query

        $adapter = New-Object -TypeName System.Data.SQLite.SQLiteDataAdapter -ArgumentList $command
        $dataset = New-Object -TypeName System.Data.DataSet
        $adapter.Fill($dataset) | Out-Null

        $dataset.Tables[0] | Export-Csv -Path $OutputPath -NoTypeInformation
    }
    catch {
        Write-Host "Failed to export data from SQLite database: $_" -ForegroundColor Red
    }
    finally {
        if ($connection.State -eq 'Open') {
            $connection.Close()
            $connection.Dispose()
        }
    }
}

# Copy browser-related information to the folder
Copy-Item -Path $chromeBookmarksPath -Destination $folderPath -ErrorAction SilentlyContinue
Copy-Item -Path $firefoxBookmarksPath -Destination $folderPath -Recurse -ErrorAction SilentlyContinue

# Export Chrome history to CSV
$chromeHistoryCsvPath = Join-Path -Path $folderPath -ChildPath "ChromeHistory.csv"
$chromeHistoryQuery = "SELECT url, title, last_visit_time FROM urls ORDER BY last_visit_time DESC"
Export-SqliteToCsv -DatabasePath $chromeHistoryPath -Query $chromeHistoryQuery -OutputPath $chromeHistoryCsvPath

# Export Firefox history to CSV
$firefoxHistoryCsvPath = Join-Path -Path $folderPath -ChildPath "FirefoxHistory.csv"
$firefoxHistoryQuery = "SELECT url, title, last_visit_date FROM moz_places ORDER BY last_visit_date DESC"
Export-SqliteToCsv -DatabasePath $firefoxHistoryPath -Query $firefoxHistoryQuery -OutputPath $firefoxHistoryCsvPath

# Export Brave history to CSV
$braveHistoryCsvPath = Join-Path -Path $folderPath -ChildPath "BraveHistory.csv"
$braveHistoryQuery = "SELECT url, title, last_visit_time FROM urls ORDER BY last_visit_time DESC"
Export-SqliteToCsv -DatabasePath $braveHistoryPath -Query $braveHistoryQuery -OutputPath $braveHistoryCsvPath

# Copy Brave cookies to the folder
Copy-Item -Path $braveCookiesPath -Destination $folderPath -ErrorAction SilentlyContinue
