Code Obfuscation

Spaghetti code,
Encryption,
making method call names meaningless(for VB & .NET)
code flow obfuscation

self-modifying code

polymorphism (changing the binary, each time the binary is copied)


Still other techniques have to do with the way the operating system handles debugging. 
These include calls to Windows API functions that tells us if the target is being debugged, 
checking for breakpoints dynamically in the code, 
removing hardware breakpoints, 
and using known bugs in debuggers to attempt to crash the debugger.

##################################

WinAPI features:-

BOOL WINAPI IsDebuggerPresent(void);

BOOL WINAPI CheckRemoteDebuggerPresent(  
_In_    HANDLE hProcess,  
_Inout_ PBOOL  pbDebuggerPresent
);

NtSetInformationThread(
GetCurrentThread(),
0x11, // ThreadHideFromDebugger
0, 0);

NtQueryInformationProcess(      
...,      
0x07,  // ProcessDebugPort      
...)

void WINAPI OutputDebugString(  
_In_opt_ LPCTSTR lpOutputString
);

//“Silently” fails if debugger is not attached (GLE set)

###################################

Looking for Debugger:- (During Dynamic Analysis)

FindWindow
CreateToolhelp32Snapshot
CreateFile

###################################

Time-based dbg detection:-

GetLocalTime
GetSystemTime
GetTickCount
QueryPerformanceCounter....
RDPMC/RDTSC instructions

###################################

OEP Obfuscation




Types of Breakpoint:-

Software breakpoint (SW BP)
Hardware breakpoint (HW BP)
Single-step mode

