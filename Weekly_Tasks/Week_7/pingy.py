import requests
import json
import random
import subprocess

def check_ip_reputation(ip_address):
    url = 'https://api.abuseipdb.com/api/v2/check'
    querystring = {
        'ipAddress': ip_address,
        'maxAgeInDays': '90'
    }

    headers = {
        'Accept': 'application/json',
        'Key': 'dece0f9ae03ec94ea796ba3b7ef47c4c15b725f074987d8dc1d75dda649c3e6e1717fb2786e8e95f'
    }

    response = requests.get(url, headers=headers, params=querystring)

    if response.status_code == 200:
        decoded_response = json.loads(response.text)
        data = decoded_response.get('data', {})
        is_malicious = data.get('isWhitelisted', False)
        domain = data.get('domain', None)
        if is_malicious == False:
            is_malicious = True
        if is_malicious == None:
            is_malicious = False
        return is_malicious, domain
    else:
        # Unable to check reputation (consider it non-malicious)
        return False, None

def generate_random_ip():
    return ".".join(str(random.randint(0, 255)) for _ in range(4))

def generate_malicious_ip(defender_ip):
    parts = defender_ip.split(".")
    malicious_ip_parts = [str(random.randint(0, 255)) for _ in range(2)]
    malicious_ip_parts.extend(parts[2:]) 
    return ".".join(malicious_ip_parts)

def ping(ip_address):
    try:
        # Use the 'ping' command to check if the IP is reachable
        subprocess.check_output(["ping", "-c", "1", ip_address], timeout=5)
        return True  # IP is reachable
    except subprocess.CalledProcessError:
        return False  # IP is not reachable
    except subprocess.TimeoutExpired:
        return False  # IP is not reachable (timed out)

def main():
    defender_ip = generate_random_ip()
    print("Defender IP:", defender_ip)

    malicious_ip = generate_malicious_ip(defender_ip)
    # malicious_ip = "198.199.108.71"
    print("Malicious IP:", malicious_ip)

    print("Checking random IPs...")
    for _ in range(100):
        random_ip = generate_random_ip()
        # is_reachable = ping(random_ip) # uncomment if needed at your own discretion
        is_reachable = False
        is_malicious, domain = check_ip_reputation(random_ip)
        print(f"IP: {random_ip}, Reachable: {is_reachable}, Malicious: {is_malicious}, Domain: {domain}")

    print("Checking malicious IP...")
    # is_reachable = ping(malicious_ip) # uncomment if needed at your own discretion
    is_reachable = False
    is_malicious, domain = check_ip_reputation(malicious_ip)
    print(f"Malicious IP: {malicious_ip}, Reachable: {is_reachable}, Malicious: {is_malicious}, Domain: {domain}")

if __name__ == "__main__":
    main()
